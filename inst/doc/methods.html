<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Methods</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Methods</h1>


<div id="TOC">
<ul>
<li><a href="#models" id="toc-models"><span class="toc-section-number">1</span> Models</a>
<ul>
<li><a href="#common-notation" id="toc-common-notation"><span class="toc-section-number">1.1</span> Common notation</a></li>
<li><a href="#model-matrices" id="toc-model-matrices"><span class="toc-section-number">1.2</span> Model matrices</a></li>
<li><a href="#baseline-covariates" id="toc-baseline-covariates"><span class="toc-section-number">1.3</span> Baseline covariates</a></li>
<li><a href="#post-processing" id="toc-post-processing"><span class="toc-section-number">1.4</span> Post-processing</a></li>
<li><a href="#mixture-model" id="toc-mixture-model"><span class="toc-section-number">1.5</span> Mixture model</a></li>
<li><a href="#hierarchical-model" id="toc-hierarchical-model"><span class="toc-section-number">1.6</span> Hierarchical model</a></li>
<li><a href="#independent-model" id="toc-independent-model"><span class="toc-section-number">1.7</span> Independent model</a></li>
<li><a href="#pooled-model" id="toc-pooled-model"><span class="toc-section-number">1.8</span> Pooled model</a></li>
<li><a href="#simple-model" id="toc-simple-model"><span class="toc-section-number">1.9</span> Simple model</a></li>
</ul></li>
<li><a href="#borrowing-metrics" id="toc-borrowing-metrics"><span class="toc-section-number">2</span> Borrowing metrics</a>
<ul>
<li><a href="#effective-sample-size-ess" id="toc-effective-sample-size-ess"><span class="toc-section-number">2.1</span> Effective sample size
(ESS)</a></li>
<li><a href="#precision-ratio-hierarchical-model-only" id="toc-precision-ratio-hierarchical-model-only"><span class="toc-section-number">2.2</span> Precision ratio (hierarchical
model only)</a></li>
<li><a href="#variance-shift-ratio" id="toc-variance-shift-ratio"><span class="toc-section-number">2.3</span> Variance shift ratio</a></li>
<li><a href="#mean-shift-ratio-legacy" id="toc-mean-shift-ratio-legacy"><span class="toc-section-number">2.4</span> Mean shift ratio (legacy)</a></li>
<li><a href="#posterior-mixture-proportions-mixture-model-only" id="toc-posterior-mixture-proportions-mixture-model-only"><span class="toc-section-number">2.5</span> Posterior mixture proportions
(mixture model only)</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(historicalborrow)</span></code></pre></div>
<p>This vignette defines the models and historical borrowing metrics
supported in the <code>historicalborrow</code> package.</p>
<div id="models" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Models</h1>
<div id="common-notation" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Common notation</h2>
<ul>
<li><span class="math inline">\(y\)</span>: vector of patient-specific
clinical responses to a continuous outcome variable. Ideally, the
outcome variable should be some form of change from baseline, not the
response itself. If the outcome is the raw response, then the treatment
effect will not be meaningful.</li>
<li><span class="math inline">\(y_{ij}\)</span>: the element of <span class="math inline">\(y\)</span> corresponding to study <span class="math inline">\(i\)</span> patient <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\((X)_{ij}\)</span>: the row of matrix
<span class="math inline">\(X\)</span> corresponding to study <span class="math inline">\(i\)</span> patient <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\alpha\)</span>: Vector of control group
mean parameters, one for each study. The first elements are for the
historical studies, and the last one is for the current study.</li>
<li><span class="math inline">\(\delta\)</span>: Vector of
study-specific treatment mean parameters. There is one for each
combination of study and non-control treatment group.</li>
<li><span class="math inline">\(d\)</span>: integer index for the
elements of <span class="math inline">\(\delta\)</span>.</li>
<li><span class="math inline">\(b\)</span>: integer index for the
elements of <span class="math inline">\(\beta\)</span>.</li>
<li><span class="math inline">\(\beta\)</span>: Vector of study-specific
baseline covariate parameters.</li>
<li><span class="math inline">\(X_\alpha\)</span>: matrix for the
control group mean parameters <span class="math inline">\(\alpha\)</span>. It has indicator columns to
select the appropriate element of <span class="math inline">\(\alpha\)</span> for each element of <span class="math inline">\(y\)</span>.</li>
<li><span class="math inline">\(X_\delta\)</span>: matrix for the
treatment mean parameters <span class="math inline">\(\delta\)</span>.
It has indicator columns to select the appropriate element of <span class="math inline">\(\delta\)</span> for each element of <span class="math inline">\(y\)</span>.</li>
<li><span class="math inline">\(X_\beta\)</span>: matrix for the
baseline covariate fixed effect parameters <span class="math inline">\(\beta\)</span>. It has indicator columns to select
the appropriate element of <span class="math inline">\(\beta\)</span>
for each element of <span class="math inline">\(y\)</span>.</li>
<li><span class="math inline">\(\sigma\)</span>: Vector of
study-specific residual standard deviations.</li>
<li><span class="math inline">\(I(\cdot)\)</span>: indicator
function.</li>
</ul>
</div>
<div id="model-matrices" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Model matrices</h2>
<p>Each primary model is parameterized thus:</p>
<p><span class="math display">\[
\begin{aligned}
E(y) = X_\alpha \alpha + X_\delta \delta + X_\beta \beta
\end{aligned}
\]</span></p>
<p>Above, <span class="math inline">\(X_\alpha\)</span>, <span class="math inline">\(X_\delta\)</span>, and <span class="math inline">\(X_\beta\)</span> are fixed matrices. <span class="math inline">\(X_\beta\)</span> is a conventional model matrix
for the baseline covariates <span class="math inline">\(\beta\)</span>,
and the details are explained in the “Baseline covariates” section
below. <span class="math inline">\(X_\alpha\)</span> is a matrix of
zeroes and ones. It is constructed such that each scalar component of
<span class="math inline">\(\alpha\)</span> is the mean response of the
control group in a particular study. Likewise, <span class="math inline">\(X_\delta\)</span> is a matrix of zeroes and ones
such that each scalar component of <span class="math inline">\(\delta\)</span> is the mean response of a
non-control treatment group in a particular study.</p>
<p>To illustrate, let <span class="math inline">\(y_{ijk}\)</span> be
patient <span class="math inline">\(i\)</span> in treatment group <span class="math inline">\(j\)</span> (where <span class="math inline">\(j =
1\)</span> is the control group) of study <span class="math inline">\(k\)</span>, and let <span class="math inline">\(\left ( X_\beta \beta \right )_{ijk}\)</span> be
the corresponding scalar element of the vector <span class="math inline">\(X_\beta \beta\)</span>. Then,</p>
<p><span class="math display">\[
\begin{aligned}
E(y_{ijk}) = I (j = 1) \alpha_{k} + I (j &gt; 1) \delta_{jk} + \left (
X_\beta \beta \right )_{ijk}
\end{aligned}
\]</span></p>
<p>This parameterization is represented in the more compact expression
<span class="math inline">\(X_\alpha \alpha + X_\delta \delta + X_\beta
\beta\)</span> in the model definitions in this vignette.</p>
</div>
<div id="baseline-covariates" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Baseline
covariates</h2>
<p>The baseline covariates model matrix <span class="math inline">\(X_\beta\)</span> adjusts for baseline covariates.
It may contain a continuous column for baseline and binary indicator
columns for the levels of user-defined covariates. All these columns are
included if possible, but the method automatically drops baseline
covariate columns to ensure that the combined model matrix <span class="math inline">\(X_i^* = \left [ {X_\alpha}^* \quad {X_\delta}^*
\quad {X_\beta}^* \right ]_i\)</span> is full rank. (Here, <span class="math inline">\(X_i^*\)</span> denotes the rows of matrix <span class="math inline">\(X\)</span> corresponding to study <span class="math inline">\(i\)</span>, with additional rows dropped if the
corresponding elements of <span class="math inline">\(y\)</span> are
missing. The additional row-dropping based on the missingness of <span class="math inline">\(y\)</span> ensures identifiability even when the
user supplies complicated many-leveled factors as covariates.) The
choice of columns to drop from <span class="math inline">\({X_\beta}_i\)</span> is determined by the rank and
pivoting strategy of the QR decomposition of <span class="math inline">\(X_i\)</span> using the Householder algorithm with
pivoting (<code>base::qr()</code>, LINPACK routine DQRDC).</p>
<p>Separately within each study, each column of <span class="math inline">\(X_\beta\)</span> is centered to have mean 0, and
if possible, scaled to have variance 1. Scaling ensures that the priors
on parameters <span class="math inline">\(\beta\)</span> remain
relatively diffuse relative to the input data. Study-level centering
ensures that the <span class="math inline">\(\alpha\)</span> parameters
truly act as <em>unconditional</em> study-specific control group means
(as opposed to conditional on the subset of patients at the reference
level of <span class="math inline">\(X_\beta\)</span>), and it ensures
that borrowing across <span class="math inline">\(\alpha\)</span>
components fully presents as control group borrowing.</p>
</div>
<div id="post-processing" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Post-processing</h2>
<p>The <code>hb_summary()</code> function post-processes the results
from the model. It accepts MCMC samples of parameters and returns
estimated marginal means of the response and treatment effect. To
estimate marginal means of the response, <code>hb_summary()</code> takes
group-level averages of posterior samples of fitted values while
dropping covariate adjustment terms from the model (i.e. <span class="math inline">\(X_\alpha \alpha + X_\delta \delta\)</span>).
Because the columns of <span class="math inline">\(X_\beta\)</span> are
centered at their means, this choice is mathematically equivalent to
<code>emmeans::emmeans()</code> with the
<code>weights = &quot;proportional&quot;</code> (<span class="citation">Lenth
(2016)</span>).</p>
</div>
<div id="mixture-model" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Mixture model</h2>
<p>Functions:</p>
<ul>
<li><code>hb_sim_mixture()</code></li>
<li><code>hb_mcmc_mixture()</code></li>
</ul>
<p>The mixture model analyzes only the data from the current study, so
we use <span class="math inline">\(X_\alpha^{\text{mixture}}\)</span>
instead of <span class="math inline">\(X_\alpha\)</span>. <span class="math inline">\(X_\alpha^{\text{mixture}}\)</span> is a one-column
matrix to indicate which elements of <span class="math inline">\(y\)</span> are part of the control group of the
current study.</p>
<p>The historical studies contribute to the model through
hyperparameters <span class="math inline">\(({m_\omega})_i\)</span> and
<span class="math inline">\((s_\omega)_i\)</span>. If study <span class="math inline">\(i\)</span> is a historical study, <span class="math inline">\(({m_\omega})_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> are the posterior mean and
posterior standard deviation, respectively, of the mean control group
response estimated from the simple model described later. If study <span class="math inline">\(i\)</span> is the current study, <span class="math inline">\(({m_\omega})_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> are chosen so the mixture
component Normal(<span class="math inline">\(({m_\omega})_i\)</span>,
<span class="math inline">\((s_\omega)_i\)</span>) of study <span class="math inline">\(i\)</span> is diffuse and non-informative.
Variable <span class="math inline">\(\omega_i\)</span> of study <span class="math inline">\(i\)</span> is the latent variable of mixture
component <span class="math inline">\(i\)</span>, and the index variable
<span class="math inline">\(\pi\)</span> chooses which <span class="math inline">\(\omega_i\)</span> to use for the current study
control group mean <span class="math inline">\(\alpha\)</span>.
Hyperparameter <span class="math inline">\(p_\omega\)</span> is a
constant vector of prior mixture proportions of each study. The
posterior histogram of <span class="math inline">\(\pi\)</span> gives
the posterior mixture proportions.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij}  \stackrel{\text{ind}}{\sim} \text{N} \left ( \left
(X_\alpha^{\text{mixture}} \alpha + X_\delta \delta + X_\beta \beta
\right )_{ij}, \ \sigma^2 \right) \\
&amp; \qquad \alpha = \omega_{\pi} \\
&amp; \qquad \qquad \omega_i \stackrel{\text{ind}}{\sim}
\text{Normal}(({m_\omega})_i, (s_\omega)_i^2) \\
&amp; \qquad \qquad \pi \sim \text{Categorical}(p_\omega) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\delta^2) \\
&amp; \qquad \beta_b \sim \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \sigma \sim \text{Uniform}(0, s_\sigma)
\end{aligned}
\]</span></p>
</div>
<div id="hierarchical-model" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Hierarchical
model</h2>
<p>Functions:</p>
<ul>
<li><code>hb_sim_hierarchical()</code></li>
<li><code>hb_mcmc_hierarchical()</code></li>
<li><code>hb_s_tau()</code></li>
</ul>
<p>The hierarchical model is equivalent to the meta-analytic combined
(MAC) approach analyzes the data from all studies and shrinks the
control group means <span class="math inline">\(\alpha_i\)</span>
towards a common normal distribution with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\tau^2\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left (X_\alpha \alpha + X_\delta
\delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right )\\
&amp; \qquad \alpha_i \stackrel{\text{ind}}{\sim} \text{Normal}(\mu,
\tau^2) \\
&amp; \qquad \qquad \mu \sim \text{Normal}(0, s_\mu^2) \\
&amp; \qquad \qquad \tau \sim f_\tau \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0,
s_\sigma)
\end{aligned}
\]</span></p>
<p>The prior <span class="math inline">\(f_\tau\)</span> on <span class="math inline">\(\tau\)</span> is critically important because:</p>
<ol style="list-style-type: decimal">
<li>It controls the prior amount of borrowing, and</li>
<li>The prior has a large influence if there are few historical studies
in the data.</li>
</ol>
<p><span class="math inline">\(f_\tau\)</span> can either be a flexible
half-Student-t distribution with <span class="math inline">\(d_\tau\)</span> degrees of freedom and scale
parameter <span class="math inline">\(s_\tau\)</span>:</p>
<p><span class="math display">\[
f_\tau = \text{Student-t}(0, s_\tau, d_\tau)^+
\]</span> or a uniform distribution with lower bound 0 and upper bound
<span class="math inline">\(s_\tau\)</span>:</p>
<p><span class="math display">\[
f_\tau = \text{Uniform}(0, s_\tau)
\]</span></p>
<p>Following the recommendation of <span class="citation">Gelman
(2006)</span>, please use half-Student-t if the number of historical
studies is small and consider uniform for large numbers of historical
studies.</p>
<p>For the half-Student-t distribution, the role of the <span class="math inline">\(s_\tau\)</span> parameter is equivalent to the
<span class="math inline">\(\sigma\)</span> parameter from the <a href="https://mc-stan.org/docs/functions-reference/unbounded_continuous_distributions.html#student-t-distribution">Student-t
parameterization in the Stan user manual</a>.</p>
</div>
<div id="independent-model" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Independent
model</h2>
<p>Functions:</p>
<ul>
<li><code>hb_sim_independent()</code></li>
<li><code>hb_mcmc_independent()</code></li>
</ul>
<p>The independent model is the same as the hierarchical model, but with
independent control group parameters <span class="math inline">\(\alpha\)</span>. We use it as a no-borrowing
benchmark to quantify the borrowing strength of the hierarchical model
and the mixture model.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left (X_\alpha \alpha + X_\delta
\delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right )\\
&amp; \qquad \alpha_i \stackrel{\text{ind}}{\sim} \text{Normal}(0,
s_\alpha^2) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0,
s_\sigma)
\end{aligned}
\]</span></p>
</div>
<div id="pooled-model" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Pooled model</h2>
<p>Functions:</p>
<ul>
<li><code>hb_sim_pool()</code></li>
<li><code>hb_mcmc_pool()</code></li>
</ul>
<p>Like the independent model, the pooled model is a benchmark to
quantify the borrowing strength of the hierarchical model and the
mixture model. But instead of the no-borrowing independent model, the
pooled model represents maximum borrowing. Instead of <span class="math inline">\(X_\alpha\)</span>, below, we use <span class="math inline">\(X_\alpha^{\text{pool}}\)</span>, which has only
one column to indicate which observations belong to any control group.
In other words, the <span class="math inline">\(\alpha\)</span>
parameters are pooled, and <span class="math inline">\(\alpha\)</span>
itself is a scalar.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left ( X_\alpha^{\text{pool}} \alpha
+ X_\delta \delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right
)\\
&amp; \qquad \alpha \sim \text{Normal}(0, s_\alpha^2) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0,
s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0,
s_\sigma)
\end{aligned}
\]</span></p>
</div>
<div id="simple-model" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Simple model</h2>
<p>Functions:</p>
<ul>
<li><code>hb_mcmc_mixture_hyperparameters()</code></li>
</ul>
<p>The mixture model hyperparameters <span class="math inline">\((m_\omega)_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> of study <span class="math inline">\(i\)</span> are obtained by analyzing the control
group data of study <span class="math inline">\(i\)</span> with the
simple model below. <span class="math inline">\((m_\omega)_i\)</span>
and <span class="math inline">\((s_\omega)_i\)</span> are taken to be
the estimated posterior mean and posterior standard deviation,
respectively, of <span class="math inline">\(\mu\)</span> from this
model.</p>
<p><span class="math display">\[
\begin{aligned}
&amp;y \sim \text{Normal}(\mu, \sigma^2) \\
&amp; \qquad \mu \sim \text{Normal}(0, s_\mu^2) \\
&amp; \qquad \sigma \sim \text{Uniform}(0, s_\sigma)
\end{aligned}
\]</span></p>
</div>
</div>
<div id="borrowing-metrics" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Borrowing metrics</h1>
<p>The package supports the following metrics to quantify borrowing.</p>
<div id="effective-sample-size-ess" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Effective sample size
(ESS)</h2>
<p>See the <code>hb_ess()</code> function for an implementation.</p>
<p><span class="citation">Neuenschwander et al. (2006)</span> posit a
prior effective sample size metric for meta-analytic predictive (MAP)
priors. In the original paper, the underlying hierarchical model only
uses historical controls, and the hypothetical new study is the current
study of interest. In <code>historicalborrow</code>, we adapt this
metric to a hierarchical model which also includes both control and
treatment data from the current study. We still define <span class="math inline">\(N\)</span> below to be the number of (non-missing)
historical control patients so we can still interpret ESS on the same
scale as in the paper.</p>
<p>For the pooled model, define <span class="math inline">\(V_0\)</span>
to be the posterior predictive variance of the control mean <span class="math inline">\(\alpha^*\)</span> of a hypothetical new unobserved
study. According to <span class="citation">Neuenschwander et al.
(2006)</span>, it can be derived as an average of study-specific
variances. In practice, we estimate <span class="math inline">\(V_0\)</span> using the average of MCMC samples of
<span class="math inline">\(\frac{1}{\sum \sigma_i^{-2}}\)</span>.</p>
<p><span class="math display">\[
V_0 := \text{Var}(\alpha^* | y, \tau = 0) = \frac{1}{\sum \sigma_i^{-2}}
\]</span></p>
<p>For the hierarchical model, we define the analogous posterior
predictive variance <span class="math inline">\(V_\tau\)</span> using
the prior distribution.</p>
<p><span class="math display">\[
V_\tau := \text{Var}(\alpha^* | y) = \int E[(\alpha^* - E(\alpha^*|y))^2
| y] \cdot p(\alpha^* | \mu, \tau) \cdot p(\mu, \tau | y) d\mu d\tau
\]</span></p>
<p>The above integral implies a straightforward method of estimating
<span class="math inline">\(V_\tau\)</span> using MCMC samples:</p>
<ol style="list-style-type: decimal">
<li>For each MCMC sample <span class="math inline">\(m = 1, \ldots,
M\)</span> from the hierarchical model, identify samples <span class="math inline">\(\mu^{(m)}\)</span> and <span class="math inline">\(\tau^{(m)}\)</span> of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>, respectively.</li>
<li>Draw <span class="math inline">\((\alpha^*)^{m}\)</span> from a
Normal(<span class="math inline">\(\mu^{(m)}\)</span>, <span class="math inline">\((\tau^{(m)})^2\)</span>) distribution.</li>
<li>Estimate <span class="math inline">\(V_\tau\)</span> as the variance
of the collection <span class="math inline">\((\alpha^*)^{1},
(\alpha^*)^{2}, \ldots, (\alpha^*)^{M}\)</span> from (2).</li>
</ol>
<p>Next, define <span class="math inline">\(N\)</span> as the number of
non-missing control patients from the historical studies only. Given
<span class="math inline">\(N\)</span>, <span class="math inline">\(V_0\)</span>, and <span class="math inline">\(V_\tau\)</span>, define the effective sample size
as:</p>
<p><span class="math display">\[
\text{ESS} := N \frac{V_0}{V_\tau}
\]</span></p>
<p><span class="math inline">\(\frac{V_0}{V_\tau}\)</span> is a weight
which quantifies the fraction of historical information that the
hierarchical model leverages for borrowing. Notably, the weight should
be 1 if the hierarchical and pooled model exhibit the same strength of
borrowing. Multiplied by <span class="math inline">\(N\)</span>, the
quantity becomes a heuristic for the strength of borrowing of the
hierarchical model, measured in terms of the number of historical
patients.</p>
</div>
<div id="precision-ratio-hierarchical-model-only" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Precision ratio
(hierarchical model only)</h2>
<p>The precision ratio is an experimental ad hoc metric and should be
used with caution. It is implemented in the <code>hb_summary()</code>
function for the hierarchical model.</p>
<p>The precision ratio compares the prior precision of a control mean
response (an <span class="math inline">\(\alpha\)</span> component,
numerator) to the analogous precision of the full conditional
distribution (denominator). The former is <span class="math inline">\(\frac{1}{\tau^2}\)</span>, and the latter is <span class="math inline">\(\frac{1}{\tau^2} + \frac{n}{\sigma^2}\)</span>.
Here, <span class="math inline">\(n\)</span> is the number of
non-missing patients in the current study, <span class="math inline">\(\sigma^2\)</span> is the residual variance, and
<span class="math inline">\(\tau^2\)</span> is the variance of
study-specific control means (components of <span class="math inline">\(\alpha\)</span>). The full precision ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\frac{1}{\tau^2}}{\frac{1}{\tau^2} + \frac{n}{\sigma^2}}
\end{aligned}
\]</span></p>
<p>The precision ratio comes from the conditional distribution of <span class="math inline">\(\alpha_k\)</span> in the hierarchical model given
the other parameters and the data. More precisely, in this conditional
distribution, the mean is a weighted average between the prior mean and
data mean, and the precision ratio is the weight on the prior mean. This
can be seen in a simpler case with a Bayesian model with a normal data
model, a normal prior on the mean, and known constant variance. For
details, see Chapter 2 of <span class="citation">Gelman et al.
(2020)</span>.</p>
</div>
<div id="variance-shift-ratio" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Variance shift
ratio</h2>
<p>The variance shift ratio is an experimental ad hoc metric and should
be used with caution. It is implemented in the legacy
<code>hb_metrics()</code> function.</p>
<p>Let <span class="math inline">\(V_m\)</span> be the estimated
posterior variance of <span class="math inline">\(\alpha_I\)</span>
(current study control group response mean) estimated by model <span class="math inline">\(m\)</span>. The variance shift ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{V_{m*} - V_{\text{independent}}}{V_{\text{pool}} -
V_{\text{independent}}}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(m*\)</span> is a historical
borrowing model like the mixture model or hierarchical model.</p>
</div>
<div id="mean-shift-ratio-legacy" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Mean shift ratio
(legacy)</h2>
<p>The mean shift ratio is not recommended to measure the strength of
borrowing. Rather, it is an informal ad hoc measure of the lack of
commensurability between the current and historical data sources. It is
implemented in the legacy <code>hb_metrics()</code> function.</p>
<p>To define the mean shift ratio, let <span class="math inline">\(\theta_m\)</span> be the posterior mean control
group response estimated by model <span class="math inline">\(m\)</span>. The mean shift ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\theta_{m*} - \theta_{\text{independent}}}{\theta_{\text{pool}} -
\theta_{\text{independent}}}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(m*\)</span> is a historical
borrowing model like the mixture model or hierarchical model.</p>
</div>
<div id="posterior-mixture-proportions-mixture-model-only" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Posterior mixture
proportions (mixture model only)</h2>
<p>The posterior mixture proportion of study <span class="math inline">\(i\)</span> is <span class="math inline">\(P(\pi =
i)\)</span>, and it is obtained by averaging posterior samples of <span class="math inline">\(\pi\)</span>.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gelman2006" class="csl-entry">
Gelman, A. 2006. <span>“Prior Distributions for Variance Parameters in
Hierarchical Models.”</span> <em><span>B</span>ayesian
<span>A</span>nalysis</em> 1 (3): 515–43. <a href="https://doi.org/10.1214/06-BA117A">https://doi.org/10.1214/06-BA117A</a>.
</div>
<div id="ref-bda3" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D.
B. Rubin. 2020. <em><span>B</span>ayesian <span>D</span>ata
<span>A</span>nalysis</em>. 3rd ed. <span>CRC</span> <span>P</span>ress.
</div>
<div id="ref-lenth2016" class="csl-entry">
Lenth, Russell V. 2016. <span>“Least-Squares Means: The r Package
Lsmeans.”</span> <em>Journal of Statistical Software</em> 69 (1): 1–33.
<a href="https://doi.org/10.18637/jss.v069.i01">https://doi.org/10.18637/jss.v069.i01</a>.
</div>
<div id="ref-neuenschwander2010" class="csl-entry">
Neuenschwander, B., G. Capkun-Niggli, M. Branson, and D. J.
Spiegelhalter. 2006. <span>“Summarizing Historical Information on
Controls in Clinical Trials.”</span> <em><span>B</span>ayesian
<span>A</span>nalysis</em> 1 (3): 515–43. <a href="https://doi.org/10.1214/06-BA117A">https://doi.org/10.1214/06-BA117A</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
